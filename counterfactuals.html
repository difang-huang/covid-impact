<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Victor Chernozhukov, Paul Schrimpf, Hiro Kasahara" />


<title>Causal impact of masks, policies, behavior on early COVID-19 pandemic in the U.S.</title>

<script src="site_libs/header-attrs-2.1/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/journal.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 61px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h2 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h3 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h4 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h5 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h6 {
  padding-top: 66px;
  margin-top: -66px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">COVID policies, behavior, and infection growth</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="datasummary.html">Data summary</a>
</li>
<li>
  <a href="regressionsWithPlots.html">Regresssions</a>
</li>
<li class="dropdown-header">Counterfactuals</li>
<li>
  <a href="counterfactuals.html">(without national information)</a>
</li>
<li>
  <a href="cf-pindex.html">(averaged policies, without national information)</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Causal impact of masks, policies, behavior on early COVID-19 pandemic in the U.S.</h1>
<h3 class="subtitle">Counterfactuals</h3>
<h4 class="author">Victor Chernozhukov, Paul Schrimpf, Hiro Kasahara</h4>
<h4 class="date">26 August, 2020</h4>

</div>


<p><!-- To create html files from this, in R enter  --> <!-- library(rmarkdown) --> <!-- rmarkdown::render("regressionsWithPlots.Rmd") --> <!-- To create tex files from this, in R enter ` --> <!-- library(rmarkdown) --> <!-- rmarkdown::render("regressionsWithPlots.Rmd", output_format=latex_fragment()) --></p>
<p><!-- to create the gh-pages hosted website in R enter --> <!-- rmarkdown::render_site() --></p>
<p><!-- Then in a shell  --> <!-- $ ghp-import -p -n -m "$(date)" _site --></p>
<div id="data-preparation" class="section level1" number="1">
<h1 number="1"><span class="header-section-number">1</span> Data Preparation</h1>
</div>
<div id="counterfactuals" class="section level1" number="2">
<h1 number="2"><span class="header-section-number">2</span> Counterfactuals</h1>
<pre class="r"><code>source(paste(rootdir,&quot;cases_and_policies/rmd/counterfactuals.R&quot;, sep=&quot;/&quot;))</code></pre>
<pre><code>## Loading data last updated on  2020-08-14 15:19:30 
## Run  /home/paul/covid/covid-impact/cases_and_policies/R/cases_and_policies.R  to update data.</code></pre>
<pre><code>## Warning in eval(ei, envir): Using data only up to 2020-06-30. Modify lines 4-5 of regprep.R to
## change</code></pre>
<pre class="r"><code>source(&quot;smoothtests.R&quot;)</code></pre>
<pre><code>## Warning in eval(ei, envir): Linearly interpolating and rearranging test counts and creating dlogtest varaible in
## data frame df.</code></pre>
<pre class="r"><code>infovars &lt;- list(c(&quot;dlogdc&quot;, &quot;logdc&quot;)) #,
#c(&quot;dlogdc&quot;, &quot;logdc&quot;))
#infovars2 &lt;- list(c( &quot;logdc&quot;))
tvars &lt;- &quot;dlogtests&quot;
xlist &lt;-list(&quot;&quot;)
interactions &lt;-list(&quot;month&quot;, statevars)
ilist &lt;- list(interactions) #, interactions)
iv &lt;- list(&quot;0&quot;) #,&quot;(testratedc ~ lag(testratedc,14))&quot;)

L &lt;- 14
sdf &lt;- subset(df, df$date&gt;=datelims[1]) #+L)
regs &lt;- mainregressions(sdf,
                         &quot;dlogdc&quot;, pols, bvars, infovars, tvars, xlist, ilist, iv, L=L)
m &lt;- regs$piy[[1]]$reg
cnames &lt;- c(pols, infovars[[1]])
di &lt;- dieff_table(lapply(regs$pib[[1]][1:4], function(x) x$reg$coef[,1]),
                   regs$pbiy[[1]]$reg$coef[,1],
                   regs$piy[[1]]$reg$coef[,1],
                   policies=cnames)

pib &lt;- lapply(regs$pib[[1]][1:4], function(x) x$reg)
pbiy &lt;- regs$pbiy[[1]]$reg
piy &lt;- regs$piy[[1]]$reg

S &lt;- 999
bs &lt;- bootstrap_felm(sdf, c(pib,list(pbiy,piy)), S=S)
bdi &lt;- lapply(1:S, function(i)
  dieff_table(lapply(1:4, function(j) bs[[j]][,i]),
              bs[[5]][,i], bs[[6]][,i],
              policies=cnames)
  )

subcoefs &lt;- function(di, coef) {
  for (r in 1:(nrow(di)-1)) {
    i &lt;- grep(rownames(di)[r] , rownames(coef))
    coef[i,1] &lt;- di[r,&quot;Average&quot;]
  }
  return(coef)
}

bcoefs &lt;- t(do.call(cbind, lapply(1:S, function(i) {
  coef &lt;- matrix(bs[[6]][,i],ncol=1)
  rownames(coef) &lt;- rownames(bs[[6]])
  return(subcoefs(bdi[[i]],coef ))
})))

V &lt;- cov(bcoefs)
m$coefficients &lt;- subcoefs(di, m$coefficients)
m$vcv &lt;- V
m$clustervcv &lt;- V
m$robustvcv &lt;- V

simmodel &lt;- createforwardsim(m, sdf)

# remove policies
cf &lt;- sdf
cf[,pols] &lt;- 0
nopmodel &lt;- createforwardsim(m, cf)</code></pre>
<pre><code>## Warning in chol.default(mat, pivot = TRUE, tol = tol): the matrix is either rank-deficient or
## indefinite</code></pre>
<pre class="r"><code>rerunsim=FALSE
if (!file.exists(&quot;cfnop.Rda&quot;) || rerunsim) {
  cfnoplist &lt;- lapply(unique(sdf$state), function(s)
    nopstatesim(s,simobs=simmodel,simcf=nopmodel,data=sdf, nresid=1))
  allmeans &lt;- rbindlist(lapply(cfnoplist, getmeans))
  save(cfnoplist,allmeans, file=&quot;cfnop.Rda&quot;)
}
load(&quot;cfnop.Rda&quot;)
cfnop &lt;- do.call(rbind, lapply(cfnoplist, function(x) x$edf))</code></pre>
<div id="removing-policies" class="section level3" number="2.0.1">
<h3 number="2.0.1"><span class="header-section-number">2.0.1</span> Removing Policies</h3>
<p>We now examine the impact changing from the observed policies to none. For illustrative purpose, we being by focusing on Washington. Figure  shows the observed, estimated average, and counterfactual without policies average of <span class="math inline">\(\Delta \log \Delta C\)</span> in Washington.</p>
<p>We hold residuals fixed throughout. <!-- To compute the estimated and counterfactual paths we use the estimates --> <!-- from column 2 of table \ref{tab:policy-cases}. We set initial $\Delta --> <!-- \log \Delta C$ and $\log \Delta C$ to their values first observed in --> <!-- the state we are simulating. We hold all other regressors at their --> <!-- observed values. Error terms are drawn with replacement from the --> <!-- residuals. We do this many times and report the average over draws of --> <!-- the residuals. To calculate confidence intervals, we repeat the above --> <!-- with coefficients drawn randomly from their asymptotic --> <!-- distribution. The shaded region is a pointwise 90\% confidence --> <!-- interval. --></p>
<!-- To be more precise, we can rewrite our regression model as: -->
<!-- $$ -->
<!--   Y_{it} = P_{it}'\alpha + \sum_{\ell=1}^L \rho_\ell Y_{it-\ell} + X_{it}'\beta + \epsilon_{it} -->
<!-- $$ -->
<!-- where $Y_{it} = \log \Delta C_{it}$, $P_{it}$ are policies, and -->
<!-- $X_{it}$ are controls. Each counterfactual involves changing $P_{it}$ -->
<!-- to some other value, $P_{it}^\ast$. We then generate counterfactual paths -->
<!-- for cases by in state $i$ conditional on -->
<!-- $Y_{i1}, ..., Y_{iL}, \{X_{it}, P_{it}^\ast \}_{t=1}^T, \theta=(\alpha, \beta, \rho)$ by setting: -->
<!-- $$ -->
<!--   Y_{it}^{\ast,r} = {P_{it}^\ast}'\alpha + \sum_{\ell=1}^L \rho_\ell Y_{it-\ell} + X_{it}'\beta + \hat{\epsilon}_{it}^{\ast,r} -->
<!-- $$ -->
<!-- where $\hat{\epsilon}_{it}^{\ast,r}$ are resampled with replacement -->
<!-- from $\{\hat{\epsilon}_{it}\}_{i=1,t=1}^{N,T}$. We do resample the -->
<!-- residuals $R$ times, repeating the above each time. We then compute -->
<!-- $$ -->
<!-- \hat{E}[Y_{it}^\ast | Y_{i1}, ..., Y_{iL}, \{X_{it}, P_{it}^\ast\}_{t=1}^T, \theta] = -->
<!-- \frac{1}{R} \sum_{r=1}^R Y_{it}^{\ast,r} -->
<!-- $$ -->
<!-- Finally, we repeatedly draw $\theta$ from its asymptotic distribution -->
<!-- and repeat all of the above to compute confidence intervals. -->
<!-- For case growth, the same procedure is used, but with $\Delta Y_{it} = \Delta \log \Delta C_{it}$ in place of $Y_{it}$. The top panel of the following figure shows -->
<!-- $$ -->
<!-- E[\Delta Y_{it} | Y_{i1}, ..., Y_{iL}, \{X_{it}, P_{it}\}_{t=1}^T] -->
<!-- $$ -->
<!-- and -->
<!-- $$ -->
<!-- E[\Delta Y_{it}^\ast | Y_{i1}, ..., Y_{iL}, \{X_{it}, P_{it}^\ast\}_{t=1}^T] -->
<!-- $$ -->
<!-- along with the observed $Y_{it}$, and the bottom panel shows the difference. -->
<!-- In this subsection, instead of resampling residuals, we condition on them. That is we look at -->
<!-- $$ -->
<!--   Y_{it}^{\ast} = {P_{it}^\ast}'\alpha + \sum_{\ell=1}^L \rho_\ell Y_{it-\ell} + X_{it}'\beta + \hat{\epsilon}_{it} -->
<!-- $$ -->
<!-- instead of -->
<!-- $$ -->
<!--   \frac{1}{R} \sum_{r=1}^R Y_{it}^{\ast,r}. -->
<!-- $$ -->
<pre class="r"><code>st &lt;- &quot;Washington&quot;
f &lt;- cfplots(st, cfnop, data=df)</code></pre>
<pre><code>## Warning: Ignoring unknown aesthetics: fill

## Warning: Ignoring unknown aesthetics: fill</code></pre>
<pre class="r"><code>grid.arrange(f$figd, f$figdp, nrow=2, top =
                                        textGrob(st,gp=gpar(fontsize=20,font=2)))</code></pre>
<div class="figure">
<img src="counterfactuals_files/figure-html/WA-nop-dlogdc-1.png" alt="Case growth without policies in Washington \label{fig:WA-nop-dlogdc}" width="768" />
<p class="caption">
Case growth without policies in Washington 
</p>
</div>
<p>To look at cases we instead compute,</p>
<p><span class="math display">\[
\hat{E}[\exp(Y_{it}^\ast) | Y_{i1}, ..., Y_{iL}, \{X_{it}, P_{it}^\ast\}_{t=1}^T, \theta] =
\frac{1}{R} \sum_{r=1}^R \exp(Y_{it}^{\ast,r})
\]</span></p>
<pre class="r"><code>grid.arrange(f$figl, f$figp, nrow=2) #,</code></pre>
<div class="figure">
<img src="counterfactuals_files/figure-html/WA-nop-cases-1.png" alt="Cases without policies in Washington \label{fig:WA-nop-cases}" width="768" />
<p class="caption">
Cases without policies in Washington 
</p>
</div>
<pre class="r"><code>#top = textGrob(st,gp=gpar(fontsize=20,font=2)))</code></pre>
</div>
<div id="national" class="section level2" number="2.1">
<h2 number="2.1"><span class="header-section-number">2.1</span> National</h2>
<p>These figures show the average effect on <span class="math inline">\(\Delta \log \Delta C\)</span> across states, and the total national effect on cases in past week.</p>
<p>That is for the first figure, we take:</p>
<p><span class="math display">\[
\hat{E}[\Delta Y_{it}^\ast | Y_{i1}, ..., Y_{iL}, \{X_{it}, P_{it}^\ast\}_{t=1}^T, \theta] =
\frac{1}{N} \sum_{i=1}^{N} \frac{1}{R} \sum_{r=1}^R \Delta Y_{it}^{\ast,r}
\]</span></p>
<p>and plot the difference of the above between two different values of <span class="math inline">\(P_{it}^\ast\)</span></p>
<p>The second figure shows the total change in cases, that is the change in:</p>
<p><span class="math display">\[
\hat{E}[\exp(Y_{it}^\ast) | Y_{i1}, ..., Y_{iL}, \{X_{it}, P_{it}^\ast\}_{t=1}^T, \theta] =
\sum_{i=1}^{N} \frac{1}{R} \sum_{r=1}^R \exp(Y_{it}^{\ast,r}).
\]</span></p>
<p>The final figure shows <span class="math display">\[
\frac{\sum_{i=1}^{N} \frac{1}{R} \sum_{r=1}^R \exp(Y_{it}^{\ast,r}) - \sum_{i=1}^{N} \frac{1}{R} \sum_{r=1}^R \exp(Y_{it}^r)} {\sum_{i=1}^{N} \frac{1}{R} \sum_{r=1}^R \exp(Y_{it}^{r})}
\]</span> that is, the (average over residual draws) change in national cases relative to (average over residual draws) national cases.</p>
<pre class="r"><code>abbrv &lt;- unique(df[,c(&quot;state&quot;,&quot;ST&quot;)])
cfnop &lt;- merge(cfnop, abbrv, by=&quot;state&quot;)

figs &lt;- nationalplots(allmeans,cfnop, &quot;removing policies&quot;)

figdev(paste(rootdir,&quot;tex/tables_and_figures/us-nop-dgrowth_v1.pdf&quot;,sep=&quot;/&quot;), width=5,height=3.75)
figs$g</code></pre>
<pre><code>## Warning: Removed 5 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 12 row(s) containing missing values (geom_path).</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>figdev(paste(rootdir,&quot;tex/tables_and_figures/us-nop-dcases_v1.pdf&quot;,sep=&quot;/&quot;), width=5,height=3.75)
figs$c</code></pre>
<pre><code>## Warning: Removed 5 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>figdev(paste(rootdir,&quot;tex/tables_and_figures/us-nop-rel_v1.pdf&quot;,sep=&quot;/&quot;), width=5,height=3.75)
figs$r</code></pre>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>for (f in figs) print(f)</code></pre>
<pre><code>## Warning: Removed 5 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 12 row(s) containing missing values (geom_path).</code></pre>
<p><img src="counterfactuals_files/figure-html/nop-all-1.png" width="768" /></p>
<pre><code>## Warning: Removed 5 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<p><img src="counterfactuals_files/figure-html/nop-all-2.png" width="768" /></p>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<p><img src="counterfactuals_files/figure-html/nop-all-3.png" width="768" /></p>
</div>
<div id="non-essential-business-closures" class="section level2" number="2.2">
<h2 number="2.2"><span class="header-section-number">2.2</span> Non-Essential Business Closures</h2>
<pre class="r"><code># remove non essential business closure
cf &lt;- sdf
cf[,&quot;pnonessential&quot;] &lt;- 0
nobmodel &lt;- createforwardsim(m, cf)</code></pre>
<pre><code>## Warning in chol.default(mat, pivot = TRUE, tol = tol): the matrix is either rank-deficient or
## indefinite</code></pre>
<pre class="r"><code>if (!file.exists(&quot;cfnb.Rda&quot;) || rerunsim) {
  cfnblist &lt;- lapply(unique(df$state), function(s) nopstatesim(s,simobs=simmodel,simcf=nobmodel, data=sdf, nresid=1))
  nball &lt;- rbindlist(lapply(cfnblist, getmeans))
  save(cfnblist,nball, file=&quot;cfnb.Rda&quot;)
}
load(&quot;cfnb.Rda&quot;)
cfnb &lt;- do.call(rbind, lapply(cfnblist, function(x) x$edf))</code></pre>
<pre class="r"><code>cfnb &lt;- merge(cfnb, abbrv, by=&quot;state&quot;)
for (st in c(&quot;Washington&quot;,&quot;Illinois&quot;,&quot;Massachusetts&quot;)) {
  f &lt;- cfplots(st, cfnb, data=df)
  f$figp + ggtitle(sprintf(&quot;Effect of never shutting down non-essential businesses in %s&quot;,st))
  #grid.arrange(f$figd + ggtitle(), f$figdp + ggtitle(), nrow=2, top =
  #textGrob(st,gp=gpar(fontsize=20,font=2)))

  figdev(sprintf(&quot;%s/tex/tables_and_figures/%s-nb-dgrowth_v1.pdf&quot;,rootdir,st), width=5,height=3.75)
  print(f$figdp)
  dev.off()


  figdev(sprintf(&quot;%s/tex/tables_and_figures/%s-nb-dcases_v1.pdf&quot;,rootdir,st), width=5,height=3.75)
  print(f$figp)
  dev.off()
}</code></pre>
<pre><code>## Warning: Ignoring unknown aesthetics: fill

## Warning: Ignoring unknown aesthetics: fill

## Warning: Ignoring unknown aesthetics: fill

## Warning: Ignoring unknown aesthetics: fill

## Warning: Ignoring unknown aesthetics: fill

## Warning: Ignoring unknown aesthetics: fill</code></pre>
<pre><code>## Warning: Removed 5 row(s) containing missing values (geom_path).</code></pre>
<pre class="r"><code>figs &lt;- nationalplots(nball, cfnb,
                      &quot;never shutting down non-essential\nbusinesses&quot;)

figdev(paste(rootdir,&quot;tex/tables_and_figures/us-nb-dgrowth_v1.pdf&quot;,sep=&quot;/&quot;), width=5,height=3.75)
figs$g</code></pre>
<pre><code>## Warning: Removed 12 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 12 row(s) containing missing values (geom_path).</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>figdev(paste(rootdir,&quot;tex/tables_and_figures/us-nb-dcases_v1.pdf&quot;,sep=&quot;/&quot;), width=5,height=3.75)
figs$c</code></pre>
<pre><code>## Warning: Removed 7 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>figdev(paste(rootdir,&quot;tex/tables_and_figures/us-nb-rel_v1.pdf&quot;,sep=&quot;/&quot;), width=5,height=3.75)
figs$r</code></pre>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>for (f in figs) print(f)</code></pre>
<pre><code>## Warning: Removed 12 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 12 row(s) containing missing values (geom_path).</code></pre>
<p><img src="counterfactuals_files/figure-html/unnamed-chunk-2-1.png" width="768" /></p>
<pre><code>## Warning: Removed 7 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<p><img src="counterfactuals_files/figure-html/unnamed-chunk-2-2.png" width="768" /></p>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<p><img src="counterfactuals_files/figure-html/unnamed-chunk-2-3.png" width="768" /></p>
</div>
<div id="masks" class="section level2" number="2.3">
<h2 number="2.3"><span class="header-section-number">2.3</span> Masks</h2>
<p>We now look at what happens when all states impose a mask mandate on April 1st.</p>
<pre class="r"><code>cf &lt;- df
cf[,&quot;Mandate.face.mask.use.by.employees.in.public.facing.businesses&quot;]  &lt;- as.Date(&quot;2020-04-01&quot;)
cf[,&quot;pmaskbus&quot;] &lt;-
  smoothedpolicy(cf,&quot;Mandate.face.mask.use.by.employees.in.public.facing.businesses&quot;,type=&quot;ma&quot;,bw=6)
cf &lt;- subset(cf, cf$date&gt;=datelims[1]) #+L)
maskmodel &lt;- createforwardsim(m, cf)

if (!file.exists(&quot;cfmask.Rda&quot;) || rerunsim) {
  cfmasklist &lt;- lapply(unique(df$state), function(s) nopstatesim(s,simobs=simmodel,simcf=maskmodel, data=sdf, nresid=1))
  maskall &lt;- rbindlist(lapply(cfmasklist, getmeans))
  save(cfmasklist, maskall, file=&quot;cfmask.Rda&quot;)
}
load(&quot;cfmask.Rda&quot;)
cfmask &lt;- do.call(rbind, lapply(cfmasklist, function(x) x$edf))</code></pre>
<pre class="r"><code>cfmask &lt;- merge(cfmask, abbrv, by=&quot;state&quot;)
for (st in c(&quot;Washington&quot;,&quot;Illinois&quot;,&quot;Massachusetts&quot;)) {
  f &lt;- cfplots(st, cfmask, data=df)
  print(f$figp +  ggtitle(sprintf(&quot;Effect of mandating masks on April 1st in %s&quot;,st)))

  figdev(sprintf(&quot;%s/tex/tables_and_figures/%s-mask-dgrowth_v1.pdf&quot;,rootdir,st), width=5,height=3.75)
  print(f$figdp)
  dev.off()

  figdev(sprintf(&quot;%s/tex/tables_and_figures/%s-mask-dcases_v1.pdf&quot;,rootdir,st), width=5,height=3.75)
  print(f$figp)
  dev.off()
}</code></pre>
<pre><code>## Warning: Ignoring unknown aesthetics: fill

## Warning: Ignoring unknown aesthetics: fill

## Warning: Ignoring unknown aesthetics: fill

## Warning: Ignoring unknown aesthetics: fill</code></pre>
<p><img src="counterfactuals_files/figure-html/unnamed-chunk-3-1.png" width="768" /></p>
<pre><code>## Warning: Ignoring unknown aesthetics: fill

## Warning: Ignoring unknown aesthetics: fill</code></pre>
<p><img src="counterfactuals_files/figure-html/unnamed-chunk-3-2.png" width="768" /></p>
<pre><code>## Warning: Removed 5 row(s) containing missing values (geom_path).</code></pre>
<p><img src="counterfactuals_files/figure-html/unnamed-chunk-3-3.png" width="768" /></p>
<pre class="r"><code>figs &lt;- nationalplots(maskall, cfmask, &quot;mandating masks on April 1st\n&quot;)

figdev(paste(rootdir,&quot;tex/tables_and_figures/us-mask-dgrowth_v1.pdf&quot;,sep=&quot;/&quot;), width=5,height=3.75)
figs$g</code></pre>
<pre><code>## Warning: Removed 12 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 12 row(s) containing missing values (geom_path).</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>figdev(paste(rootdir,&quot;tex/tables_and_figures/us-mask-dcases_v1.pdf&quot;,sep=&quot;/&quot;), width=5,height=3.75)
figs$c</code></pre>
<pre><code>## Warning: Removed 7 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>figdev(paste(rootdir,&quot;tex/tables_and_figures/us-mask-rel_v1.pdf&quot;,sep=&quot;/&quot;), width=5,height=3.75)
figs$r</code></pre>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>for (f in figs) print(f)</code></pre>
<pre><code>## Warning: Removed 12 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 12 row(s) containing missing values (geom_path).</code></pre>
<p><img src="counterfactuals_files/figure-html/unnamed-chunk-3-4.png" width="768" /></p>
<pre><code>## Warning: Removed 7 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<p><img src="counterfactuals_files/figure-html/unnamed-chunk-3-5.png" width="768" /></p>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<p><img src="counterfactuals_files/figure-html/unnamed-chunk-3-6.png" width="768" /></p>
</div>
<div id="stay-at-home" class="section level2" number="2.4">
<h2 number="2.4"><span class="header-section-number">2.4</span> Stay at home</h2>
<p>We now look at what happens if stay at home orders were never issued.</p>
<pre class="r"><code>cf &lt;- df
cf[,&quot;pshelter&quot;] &lt;- 0
cf &lt;- subset(cf, cf$date&gt;=datelims[1]) #+L)
noshelter &lt;- createforwardsim(m, cf)</code></pre>
<pre><code>## Warning in chol.default(mat, pivot = TRUE, tol = tol): the matrix is either rank-deficient or
## indefinite</code></pre>
<pre class="r"><code>if (!file.exists(&quot;cfshelter.Rda&quot;) || rerunsim) {
  cfshelterlist &lt;- lapply(unique(df$state), function(s) nopstatesim(s,simobs=simmodel,simcf=noshelter, data=sdf, nresid=1))
  shelterall &lt;- rbindlist(lapply(cfshelterlist, getmeans))
  save(cfshelterlist, shelterall, file=&quot;cfshelter.Rda&quot;)
}
load(&quot;cfshelter.Rda&quot;)
cfshelter &lt;- do.call(rbind, lapply(cfshelterlist, function(x) x$edf))</code></pre>
<pre class="r"><code>cfshelter &lt;- merge(cfshelter, abbrv, by=&quot;state&quot;)
for (st in c(&quot;Washington&quot;,&quot;Illinois&quot;,&quot;Massachusetts&quot;)) {
  f &lt;- cfplots(st, cfshelter, data=df)
  print(f$figp +  ggtitle(sprintf(&quot;Effect of no stay at home order in %s&quot;,st)))

  figdev(sprintf(&quot;%s/tex/tables_and_figures/%s-shelter-dgrowth_v1.pdf&quot;,rootdir,st), width=5,height=3.75)
  print(f$figdp)
  dev.off()

  figdev(sprintf(&quot;%s/tex/tables_and_figures/%s-shelter-dcases_v1.pdf&quot;,rootdir,st), width=5,height=3.75)
  print(f$figp)
  dev.off()
}</code></pre>
<pre><code>## Warning: Ignoring unknown aesthetics: fill

## Warning: Ignoring unknown aesthetics: fill

## Warning: Ignoring unknown aesthetics: fill

## Warning: Ignoring unknown aesthetics: fill</code></pre>
<p><img src="counterfactuals_files/figure-html/unnamed-chunk-4-1.png" width="768" /></p>
<pre><code>## Warning: Ignoring unknown aesthetics: fill

## Warning: Ignoring unknown aesthetics: fill</code></pre>
<p><img src="counterfactuals_files/figure-html/unnamed-chunk-4-2.png" width="768" /></p>
<pre><code>## Warning: Removed 5 row(s) containing missing values (geom_path).</code></pre>
<p><img src="counterfactuals_files/figure-html/unnamed-chunk-4-3.png" width="768" /></p>
<pre class="r"><code>figs &lt;- nationalplots(shelterall, cfshelter, &quot;no stay at home orders&quot;)

figdev(paste(rootdir,&quot;tex/tables_and_figures/us-shelter-dgrowth_v1.pdf&quot;,sep=&quot;/&quot;), width=5,height=3.75)
figs$g</code></pre>
<pre><code>## Warning: Removed 12 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 12 row(s) containing missing values (geom_path).</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>figdev(paste(rootdir,&quot;tex/tables_and_figures/us-shelter-dcases_v1.pdf&quot;,sep=&quot;/&quot;), width=5,height=3.75)
figs$c</code></pre>
<pre><code>## Warning: Removed 7 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>figdev(paste(rootdir,&quot;tex/tables_and_figures/us-shelter-rel_v1.pdf&quot;,sep=&quot;/&quot;), width=5,height=3.75)
figs$r</code></pre>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>for (f in figs) print(f)</code></pre>
<pre><code>## Warning: Removed 12 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 12 row(s) containing missing values (geom_path).</code></pre>
<p><img src="counterfactuals_files/figure-html/unnamed-chunk-4-4.png" width="768" /></p>
<pre><code>## Warning: Removed 7 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<p><img src="counterfactuals_files/figure-html/unnamed-chunk-4-5.png" width="768" /></p>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<p><img src="counterfactuals_files/figure-html/unnamed-chunk-4-6.png" width="768" /></p>
</div>
<div id="shutdown-policies" class="section level2" number="2.5">
<h2 number="2.5"><span class="header-section-number">2.5</span> Shutdown policies</h2>
<p>We now look at what happens if the four shutdown policies in pindex were never implemented.</p>
<pre class="r"><code>cf &lt;- df
cf[,&quot;pshelter&quot;] &lt;- 0
cf[,&quot;pmovie&quot;] &lt;- 0
cf[,&quot;prestaurant&quot;] &lt;- 0
cf[,&quot;pnonessential&quot;] &lt;- 0
cf &lt;- subset(cf, cf$date&gt;=datelims[1]) #+L)
noindex &lt;- createforwardsim(m, cf)</code></pre>
<pre><code>## Warning in chol.default(mat, pivot = TRUE, tol = tol): the matrix is either rank-deficient or
## indefinite</code></pre>
<pre class="r"><code>if (!file.exists(&quot;cfindex.Rda&quot;) || rerunsim) {
  cfindexlist &lt;- lapply(unique(df$state), function(s) nopstatesim(s,simobs=simmodel,simcf=noindex, data=sdf, nresid=1))
  indexall &lt;- rbindlist(lapply(cfindexlist, getmeans))
  save(cfindexlist, indexall, file=&quot;cfindex.Rda&quot;)
}
load(&quot;cfindex.Rda&quot;)
cfindex &lt;- do.call(rbind, lapply(cfindexlist, function(x) x$edf))</code></pre>
<pre class="r"><code>cfindex &lt;- merge(cfindex, abbrv, by=&quot;state&quot;)
for (st in c(&quot;Washington&quot;,&quot;Illinois&quot;,&quot;Massachusetts&quot;)) {
  f &lt;- cfplots(st, cfindex, data=df, yvar=&quot;deaths&quot;)
  print(f$figp +  ggtitle(sprintf(&quot;Effect of no shutdown policies in %s&quot;,st)))

  figdev(sprintf(&quot;%s/tex/tables_and_figures/%s-index-dgrowth.pdf&quot;,rootdir,st), width=5,height=3.75)
  print(f$figdp)
  dev.off()

  figdev(sprintf(&quot;%s/tex/tables_and_figures/%s-index-dcases.pdf&quot;,rootdir,st), width=5,height=3.75)
  print(f$figp)
  dev.off()
}</code></pre>
<pre><code>## Warning: Ignoring unknown aesthetics: fill

## Warning: Ignoring unknown aesthetics: fill

## Warning: Ignoring unknown aesthetics: fill

## Warning: Ignoring unknown aesthetics: fill</code></pre>
<p><img src="counterfactuals_files/figure-html/unnamed-chunk-5-1.png" width="768" /></p>
<pre><code>## Warning: Ignoring unknown aesthetics: fill

## Warning: Ignoring unknown aesthetics: fill</code></pre>
<p><img src="counterfactuals_files/figure-html/unnamed-chunk-5-2.png" width="768" /><img src="counterfactuals_files/figure-html/unnamed-chunk-5-3.png" width="768" /></p>
<pre class="r"><code>figs &lt;- nationalplots(indexall, cfindex, &quot;no shutdown policies&quot;, yvar=&quot;deaths&quot;)

figdev(paste(rootdir,&quot;tex/tables_and_figures/us-index-dgrowth.pdf&quot;,sep=&quot;/&quot;), width=5,height=3.75)
figs$g</code></pre>
<pre><code>## Warning: Removed 5 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>figdev(paste(rootdir,&quot;tex/tables_and_figures/us-index-dcases.pdf&quot;,sep=&quot;/&quot;), width=5,height=3.75)
figs$c</code></pre>
<pre><code>## Warning: Removed 5 rows containing missing values (geom_point).

## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>figdev(paste(rootdir,&quot;tex/tables_and_figures/us-index-rel.pdf&quot;,sep=&quot;/&quot;), width=5,height=3.75)
figs$r</code></pre>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>for (f in figs) print(f)</code></pre>
<pre><code>## Warning: Removed 5 rows containing missing values (geom_point).

## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<p><img src="counterfactuals_files/figure-html/unnamed-chunk-5-4.png" width="768" /></p>
<pre><code>## Warning: Removed 5 rows containing missing values (geom_point).

## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<p><img src="counterfactuals_files/figure-html/unnamed-chunk-5-5.png" width="768" /></p>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<p><img src="counterfactuals_files/figure-html/unnamed-chunk-5-6.png" width="768" /></p>
</div>
</div>
<div id="deaths" class="section level1" number="3">
<h1 number="3"><span class="header-section-number">3</span> Deaths</h1>
<pre class="r"><code>infovars &lt;- list(c(&quot;dlogdd&quot;, &quot;logdd&quot;)) #,
#c(&quot;dlogdc&quot;, &quot;logdc&quot;))
#infovars2 &lt;- list(c( &quot;logdc&quot;))
tvars &lt;- NULL
xlist &lt;-list(&quot;&quot;)
interactions &lt;-list(&quot;month&quot;, statevars)
ilist &lt;- list(interactions) #, interactions)
iv &lt;- list(&quot;0&quot;) #,&quot;(testratedc ~ lag(testratedc,14))&quot;)

L &lt;- 21
sdf &lt;- subset(df, df$date&gt;=datelims[1]) #+L)
regs &lt;- mainregressions(sdf,
                        &quot;dlogdd&quot;, pols, bvars, infovars, tvars, xlist, ilist, iv, L=L)

m &lt;- regs$piy[[1]]$reg

cnames &lt;- c(pols, infovars[[1]])
di &lt;- dieff_table(lapply(regs$pib[[1]][1:4], function(x) x$reg$coef[,1]),
                  regs$pbiy[[1]]$reg$coef[,1],
                  regs$piy[[1]]$reg$coef[,1],
                  policies=cnames)

pib &lt;- lapply(regs$pib[[1]][1:4], function(x) x$reg)
pbiy &lt;- regs$pbiy[[1]]$reg
piy &lt;- regs$piy[[1]]$reg

S &lt;- 999
bs &lt;- bootstrap_felm(sdf, c(pib,list(pbiy,piy)), S=S)
bdi &lt;- lapply(1:S, function(i)
  dieff_table(lapply(1:4, function(j) bs[[j]][,i]),
              bs[[5]][,i], bs[[6]][,i],
              policies=cnames)
  )

bcoefs &lt;- t(do.call(cbind, lapply(1:S, function(i) {
  coef &lt;- matrix(bs[[6]][,i],ncol=1)
  rownames(coef) &lt;- rownames(bs[[6]])
  return(subcoefs(bdi[[i]],coef ))
})))
V &lt;- cov(bcoefs)
m$coefficients &lt;- subcoefs(di, m$coefficients)
m$vcv &lt;- V
m$clustervcv &lt;- V
m$robustvcv &lt;- V

simmodel &lt;- createforwardsim(m, sdf, dvar=&quot;dlogdd&quot;, var=&quot;logdd&quot;)

# remove policies
cf &lt;- sdf
cf[,pols] &lt;- 0
nopmodel &lt;- createforwardsim(m, cf, dvar=&quot;dlogdd&quot;, var=&quot;logdd&quot;)</code></pre>
<pre><code>## Warning in chol.default(mat, pivot = TRUE, tol = tol): the matrix is either rank-deficient or
## indefinite</code></pre>
<pre class="r"><code>rerunsim=FALSE
if (!file.exists(&quot;cfnop_deaths.Rda&quot;) || rerunsim) {
  cfnoplist &lt;- lapply(unique(df$state), function(s)
    nopstatesim(s,simobs=simmodel,simcf=nopmodel, data=sdf, var=&quot;logdd&quot;, dvar=&quot;dlogdd&quot;))
  allmeans &lt;- rbindlist(lapply(cfnoplist, getmeans))
  save(cfnoplist,allmeans, file=&quot;cfnop_deaths.Rda&quot;)
}
load(&quot;cfnop_deaths.Rda&quot;)
cfnop &lt;- do.call(rbind, lapply(cfnoplist, function(x) x$edf))</code></pre>
<div id="removing-policies-1" class="section level2" number="3.1">
<h2 number="3.1"><span class="header-section-number">3.1</span> Removing Policies</h2>
<pre class="r"><code>st &lt;- &quot;Washington&quot;
f &lt;- cfplots(st, cfnop, yvar=&quot;deaths&quot;, data=df)</code></pre>
<pre><code>## Warning: Ignoring unknown aesthetics: fill

## Warning: Ignoring unknown aesthetics: fill</code></pre>
<pre class="r"><code>grid.arrange(f$figd, f$figdp, nrow=2, top =
                                        textGrob(st,gp=gpar(fontsize=20,font=2)))</code></pre>
<div class="figure">
<img src="counterfactuals_files/figure-html/WA-nop-dlogdd-1.png" alt="Case growth without policies in Washington \label{fig:WA-nop-dlogdc}" width="768" />
<p class="caption">
Case growth without policies in Washington 
</p>
</div>
<pre class="r"><code>grid.arrange(f$figl, f$figp, nrow=2) #,</code></pre>
<div class="figure">
<img src="counterfactuals_files/figure-html/WA-nop-deaths-1.png" alt="Cases without policies in Washington \label{fig:WA-nop-cases}" width="768" />
<p class="caption">
Cases without policies in Washington 
</p>
</div>
<pre class="r"><code>#top = textGrob(st,gp=gpar(fontsize=20,font=2)))</code></pre>
<div id="national-1" class="section level3" number="3.1.1">
<h3 number="3.1.1"><span class="header-section-number">3.1.1</span> National</h3>
<pre class="r"><code>abbrv &lt;- unique(df[,c(&quot;state&quot;,&quot;ST&quot;)])
cfnop &lt;- merge(cfnop, abbrv, by=&quot;state&quot;)

figs &lt;- nationalplots(allmeans,cfnop, &quot;removing policies&quot;, yvar=&quot;deaths&quot;)

figdev(paste(rootdir,&quot;tex/tables_and_figures/us-nop-dgrowth_deaths_v1.pdf&quot;,sep=&quot;/&quot;), width=5,height=3.75)
figs$g</code></pre>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>figdev(paste(rootdir,&quot;tex/tables_and_figures/us-nop-dcases_deaths_v1.pdf&quot;,sep=&quot;/&quot;), width=5,height=3.75)
figs$c</code></pre>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>figdev(paste(rootdir,&quot;tex/tables_and_figures/us-nop-rel_deaths_v1.pdf&quot;,sep=&quot;/&quot;), width=5,height=3.75)
figs$r</code></pre>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>for (f in figs) print(f)</code></pre>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<p><img src="counterfactuals_files/figure-html/nop-all-deaths-1.png" width="768" /></p>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<p><img src="counterfactuals_files/figure-html/nop-all-deaths-2.png" width="768" /></p>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<p><img src="counterfactuals_files/figure-html/nop-all-deaths-3.png" width="768" /></p>
</div>
</div>
<div id="non-essential-business-closures-1" class="section level2" number="3.2">
<h2 number="3.2"><span class="header-section-number">3.2</span> Non-essential Business Closures</h2>
<pre class="r"><code># remove non essential business closure
cf &lt;- sdf
cf[,&quot;pnonessential&quot;] &lt;- 0
nobmodel &lt;- createforwardsim(m, cf, dvar=&quot;dlogdd&quot;, var=&quot;logdd&quot;)</code></pre>
<pre><code>## Warning in chol.default(mat, pivot = TRUE, tol = tol): the matrix is either rank-deficient or
## indefinite</code></pre>
<pre class="r"><code>if (!file.exists(&quot;cfnb_deaths.Rda&quot;) || rerunsim) {
  cfnblist &lt;- lapply(unique(df$state), function(s) nopstatesim(s,simobs=simmodel,simcf=nobmodel, data=sdf, var=&quot;logdd&quot;, dvar=&quot;dlogdd&quot;))
  nball &lt;- rbindlist(lapply(cfnblist, getmeans))
  save(cfnblist,nball, file=&quot;cfnb_deaths.Rda&quot;)
}
load(&quot;cfnb_deaths.Rda&quot;)
cfnb &lt;- do.call(rbind, lapply(cfnblist, function(x) x$edf))</code></pre>
<pre class="r"><code>cfnb &lt;- merge(cfnb, abbrv, by=&quot;state&quot;)
for (st in c(&quot;Washington&quot;,&quot;Illinois&quot;,&quot;Massachusetts&quot;)) {
  f &lt;- cfplots(st, cfnb, yvar=&quot;deaths&quot;, data=df)
  f$figp + ggtitle(sprintf(&quot;Effect of never shutting down non-essential businesses in %s&quot;,st))
  #grid.arrange(f$figd + ggtitle(), f$figdp + ggtitle(), nrow=2, top =
  #textGrob(st,gp=gpar(fontsize=20,font=2)))

  figdev(sprintf(&quot;%s/tex/tables_and_figures/%s-nb-dgrowth_deaths_v1.pdf&quot;,rootdir,st), width=5,height=3.75)
  print(f$figdp)
  dev.off()


  figdev(sprintf(&quot;%s/tex/tables_and_figures/%s-nb-dcases_deaths_v1.pdf&quot;,rootdir,st), width=5,height=3.75)
  print(f$figp)
  dev.off()
}</code></pre>
<pre><code>## Warning: Ignoring unknown aesthetics: fill

## Warning: Ignoring unknown aesthetics: fill

## Warning: Ignoring unknown aesthetics: fill

## Warning: Ignoring unknown aesthetics: fill

## Warning: Ignoring unknown aesthetics: fill

## Warning: Ignoring unknown aesthetics: fill</code></pre>
<pre class="r"><code>figs &lt;- nationalplots(nball, cfnb,
                      &quot;never shutting down non-essential\nbusinesses&quot;, yvar=&quot;deaths&quot;)

figdev(paste(rootdir,&quot;tex/tables_and_figures/us-nb-dgrowth_deaths_v1.pdf&quot;,sep=&quot;/&quot;), width=5,height=3.75)
figs$g</code></pre>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>figdev(paste(rootdir,&quot;tex/tables_and_figures/us-nb-dcases_deaths_v1.pdf&quot;,sep=&quot;/&quot;), width=5,height=3.75)
figs$c</code></pre>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>figdev(paste(rootdir,&quot;tex/tables_and_figures/us-nb-rel_deaths_v1.pdf&quot;,sep=&quot;/&quot;), width=5,height=3.75)
figs$r</code></pre>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>for (f in figs) print(f)</code></pre>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<p><img src="counterfactuals_files/figure-html/unnamed-chunk-6-1.png" width="768" /></p>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<p><img src="counterfactuals_files/figure-html/unnamed-chunk-6-2.png" width="768" /></p>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<p><img src="counterfactuals_files/figure-html/unnamed-chunk-6-3.png" width="768" /></p>
</div>
<div id="masks-1" class="section level2" number="3.3">
<h2 number="3.3"><span class="header-section-number">3.3</span> Masks</h2>
<p>We now look at what happens when all states impose a mask mandate on April 1st.</p>
<pre class="r"><code>cf &lt;- df
cf[,&quot;Mandate.face.mask.use.by.employees.in.public.facing.businesses&quot;]  &lt;- as.Date(&quot;2020-04-01&quot;)
cf[,&quot;pmaskbus&quot;] &lt;-
  smoothedpolicy(cf,&quot;Mandate.face.mask.use.by.employees.in.public.facing.businesses&quot;,type=&quot;ma&quot;,bw=6)
cf &lt;- subset(cf, cf$date&gt;=datelims[1]) #+L)
maskmodel &lt;- createforwardsim(m, cf, dvar=&quot;dlogdd&quot;, var=&quot;logdd&quot;)

if (!file.exists(&quot;cfmask_deaths.Rda&quot;) || rerunsim) {
  cfmasklist &lt;- lapply(unique(df$state), function(s) nopstatesim(s,simobs=simmodel,simcf=maskmodel, data=sdf, var=&quot;logdd&quot;, dvar=&quot;dlogdd&quot;))
  maskall &lt;- rbindlist(lapply(cfmasklist, getmeans))
  save(cfmasklist, maskall, file=&quot;cfmask_deaths.Rda&quot;)
}
load(&quot;cfmask_deaths.Rda&quot;)
cfmask &lt;- do.call(rbind, lapply(cfmasklist, function(x) x$edf))</code></pre>
<pre class="r"><code>cfmask &lt;- merge(cfmask, abbrv, by=&quot;state&quot;)
for (st in c(&quot;Washington&quot;,&quot;Illinois&quot;,&quot;Massachusetts&quot;)) {
  f &lt;- cfplots(st, cfmask, yvar=&quot;deaths&quot;, data=df)
  print(f$figp +  ggtitle(sprintf(&quot;Effect of mandating masks on April 1st in %s&quot;,st)))

  figdev(sprintf(&quot;%s/tex/tables_and_figures/%s-mask-dgrowth_deaths_v1.pdf&quot;,rootdir,st), width=5,height=3.75)
  print(f$figdp)
  dev.off()

  figdev(sprintf(&quot;%s/tex/tables_and_figures/%s-mask-dcases_deaths_v1.pdf&quot;,rootdir,st), width=5,height=3.75)
  print(f$figp)
  dev.off()
}</code></pre>
<pre><code>## Warning: Ignoring unknown aesthetics: fill

## Warning: Ignoring unknown aesthetics: fill

## Warning: Ignoring unknown aesthetics: fill

## Warning: Ignoring unknown aesthetics: fill</code></pre>
<p><img src="counterfactuals_files/figure-html/unnamed-chunk-7-1.png" width="768" /></p>
<pre><code>## Warning: Ignoring unknown aesthetics: fill

## Warning: Ignoring unknown aesthetics: fill</code></pre>
<p><img src="counterfactuals_files/figure-html/unnamed-chunk-7-2.png" width="768" /><img src="counterfactuals_files/figure-html/unnamed-chunk-7-3.png" width="768" /></p>
<pre class="r"><code>figs &lt;- nationalplots(maskall, cfmask, &quot;mandating masks on April 1st\n&quot;, yvar=&quot;deaths&quot;)

figdev(paste(rootdir,&quot;tex/tables_and_figures/us-mask-dgrowth_deaths_v1.pdf&quot;,sep=&quot;/&quot;), width=5,height=3.75)
figs$g</code></pre>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>figdev(paste(rootdir,&quot;tex/tables_and_figures/us-mask-dcases_deaths_v1.pdf&quot;,sep=&quot;/&quot;), width=5,height=3.75)
figs$c</code></pre>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>figdev(paste(rootdir,&quot;tex/tables_and_figures/us-mask-rel_deaths_v1.pdf&quot;,sep=&quot;/&quot;), width=5,height=3.75)
figs$r</code></pre>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>for (f in figs) print(f)</code></pre>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<p><img src="counterfactuals_files/figure-html/unnamed-chunk-7-4.png" width="768" /></p>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<p><img src="counterfactuals_files/figure-html/unnamed-chunk-7-5.png" width="768" /></p>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<p><img src="counterfactuals_files/figure-html/unnamed-chunk-7-6.png" width="768" /></p>
</div>
<div id="stay-at-home-1" class="section level2" number="3.4">
<h2 number="3.4"><span class="header-section-number">3.4</span> Stay at home</h2>
<p>We now look at what happens if stay at home orders were never issued.</p>
<pre class="r"><code>cf &lt;- df
cf[,&quot;pshelter&quot;] &lt;- 0
cf &lt;- subset(cf, cf$date&gt;=datelims[1]) #+L)
noshelter &lt;- createforwardsim(m, cf, dvar=&quot;dlogdd&quot;, var=&quot;logdd&quot;)</code></pre>
<pre><code>## Warning in chol.default(mat, pivot = TRUE, tol = tol): the matrix is either rank-deficient or
## indefinite</code></pre>
<pre class="r"><code>if (!file.exists(&quot;cfshelter_deaths.Rda&quot;) || rerunsim) {
  cfshelterlist &lt;- lapply(unique(df$state), function(s) nopstatesim(s,simobs=simmodel,simcf=noshelter, data=sdf))
  shelterall &lt;- rbindlist(lapply(cfshelterlist, getmeans))
  save(cfshelterlist, shelterall, file=&quot;cfshelter_deaths.Rda&quot;)
}
load(&quot;cfshelter_deaths.Rda&quot;)
cfshelter &lt;- do.call(rbind, lapply(cfshelterlist, function(x) x$edf))</code></pre>
<pre class="r"><code>cfshelter &lt;- merge(cfshelter, abbrv, by=&quot;state&quot;)
for (st in c(&quot;Washington&quot;,&quot;Illinois&quot;,&quot;Massachusetts&quot;)) {
  f &lt;- cfplots(st, cfshelter, data=df, yvar=&quot;deaths&quot;)
  print(f$figp +  ggtitle(sprintf(&quot;Effect of no stay at home order in %s&quot;,st)))

  figdev(sprintf(&quot;%s/tex/tables_and_figures/%s-shelter-dgrowth_deaths_v1.pdf&quot;,rootdir,st), width=5,height=3.75)
  print(f$figdp)
  dev.off()

  figdev(sprintf(&quot;%s/tex/tables_and_figures/%s-shelter-dcases_deaths_v1.pdf&quot;,rootdir,st), width=5,height=3.75)
  print(f$figp)
  dev.off()
}</code></pre>
<pre><code>## Warning: Ignoring unknown aesthetics: fill

## Warning: Ignoring unknown aesthetics: fill

## Warning: Ignoring unknown aesthetics: fill

## Warning: Ignoring unknown aesthetics: fill</code></pre>
<p><img src="counterfactuals_files/figure-html/unnamed-chunk-8-1.png" width="768" /></p>
<pre><code>## Warning: Ignoring unknown aesthetics: fill

## Warning: Ignoring unknown aesthetics: fill</code></pre>
<p><img src="counterfactuals_files/figure-html/unnamed-chunk-8-2.png" width="768" /><img src="counterfactuals_files/figure-html/unnamed-chunk-8-3.png" width="768" /></p>
<pre class="r"><code>figs &lt;- nationalplots(shelterall, cfshelter, &quot;no stay at home orders&quot;, yvar=&quot;deaths&quot;)

figdev(paste(rootdir,&quot;tex/tables_and_figures/us-shelter-dgrowth_deaths_v1.pdf&quot;,sep=&quot;/&quot;), width=5,height=3.75)
figs$g</code></pre>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>figdev(paste(rootdir,&quot;tex/tables_and_figures/us-shelter-dcases_deaths_v1.pdf&quot;,sep=&quot;/&quot;), width=5,height=3.75)
figs$c</code></pre>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>figdev(paste(rootdir,&quot;tex/tables_and_figures/us-shelter-rel_deaths_v1.pdf&quot;,sep=&quot;/&quot;), width=5,height=3.75)
figs$r</code></pre>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>for (f in figs) print(f)</code></pre>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<p><img src="counterfactuals_files/figure-html/unnamed-chunk-8-4.png" width="768" /></p>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<p><img src="counterfactuals_files/figure-html/unnamed-chunk-8-5.png" width="768" /></p>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<p><img src="counterfactuals_files/figure-html/unnamed-chunk-8-6.png" width="768" /></p>
</div>
<div id="shutdown-policies-1" class="section level2" number="3.5">
<h2 number="3.5"><span class="header-section-number">3.5</span> Shutdown policies</h2>
<p>We now look at what happens if the four shutdown policies in pindex were never implemented.</p>
<pre class="r"><code>cf &lt;- df
cf[,&quot;pshelter&quot;] &lt;- 0
cf[,&quot;pmovie&quot;] &lt;- 0
cf[,&quot;prestaurant&quot;] &lt;- 0
cf[,&quot;pnonessential&quot;] &lt;- 0
cf &lt;- subset(cf, cf$date&gt;=datelims[1]) #+L)
noindex &lt;- createforwardsim(m, cf, dvar=&quot;dlogdd&quot;, var=&quot;logdd&quot;)</code></pre>
<pre><code>## Warning in chol.default(mat, pivot = TRUE, tol = tol): the matrix is either rank-deficient or
## indefinite</code></pre>
<pre class="r"><code>if (!file.exists(&quot;cfindex_deaths.Rda&quot;) || rerunsim) {
  cfindexlist &lt;- lapply(unique(df$state), function(s) nopstatesim(s,simobs=simmodel,simcf=noindex, data=sdf))
  indexall &lt;- rbindlist(lapply(cfindexlist, getmeans))
  save(cfindexlist, indexall, file=&quot;cfindex_deaths.Rda&quot;)
}
load(&quot;cfindex_deaths.Rda&quot;)
cfindex &lt;- do.call(rbind, lapply(cfindexlist, function(x) x$edf))</code></pre>
<pre class="r"><code>cfindex &lt;- merge(cfindex, abbrv, by=&quot;state&quot;)
for (st in c(&quot;Washington&quot;,&quot;Illinois&quot;,&quot;Massachusetts&quot;)) {
  f &lt;- cfplots(st, cfindex, data=df, yvar=&quot;deaths&quot;)
  print(f$figp +  ggtitle(sprintf(&quot;Effect of no shutdown policies in %s&quot;,st)))

  figdev(sprintf(&quot;%s/tex/tables_and_figures/%s-index-dgrowth_deaths.pdf&quot;,rootdir,st), width=5,height=3.75)
  print(f$figdp)
  dev.off()

  figdev(sprintf(&quot;%s/tex/tables_and_figures/%s-index-dcases_deaths.pdf&quot;,rootdir,st), width=5,height=3.75)
  print(f$figp)
  dev.off()
}</code></pre>
<pre><code>## Warning: Ignoring unknown aesthetics: fill

## Warning: Ignoring unknown aesthetics: fill

## Warning: Ignoring unknown aesthetics: fill

## Warning: Ignoring unknown aesthetics: fill</code></pre>
<p><img src="counterfactuals_files/figure-html/unnamed-chunk-9-1.png" width="768" /></p>
<pre><code>## Warning: Ignoring unknown aesthetics: fill

## Warning: Ignoring unknown aesthetics: fill</code></pre>
<p><img src="counterfactuals_files/figure-html/unnamed-chunk-9-2.png" width="768" /><img src="counterfactuals_files/figure-html/unnamed-chunk-9-3.png" width="768" /></p>
<pre class="r"><code>figs &lt;- nationalplots(indexall, cfindex, &quot;no shutdown policies&quot;, yvar=&quot;deaths&quot;)

figdev(paste(rootdir,&quot;tex/tables_and_figures/us-index-dgrowth_deaths.pdf&quot;,sep=&quot;/&quot;), width=5,height=3.75)
figs$g</code></pre>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>figdev(paste(rootdir,&quot;tex/tables_and_figures/us-index-dcases_deaths.pdf&quot;,sep=&quot;/&quot;), width=5,height=3.75)
figs$c</code></pre>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>figdev(paste(rootdir,&quot;tex/tables_and_figures/us-index-rel_deaths.pdf&quot;,sep=&quot;/&quot;), width=5,height=3.75)
figs$r</code></pre>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<pre class="r"><code>dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>for (f in figs) print(f)</code></pre>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<p><img src="counterfactuals_files/figure-html/unnamed-chunk-9-4.png" width="768" /></p>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<p><img src="counterfactuals_files/figure-html/unnamed-chunk-9-5.png" width="768" /></p>
<pre><code>## Warning: Removed 7 row(s) containing missing values (geom_path).</code></pre>
<p><img src="counterfactuals_files/figure-html/unnamed-chunk-9-6.png" width="768" /></p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
